---
title: "Demystifying the Relationship Between Fixed/Random Effects and Unmeasured Confounding in Panel Data Analysis"
author: "Yicheng Shen, Yanjiao Yang, Huiying Lin"
date: "`r format(Sys.time(), '%d %B, %Y')`"
header-includes:
    - \setlength{\parskip}{0em}
    - \setlength{\parindent}{2em}
    - \usepackage{indentfirst}
    - \usepackage{float}
    - \usepackage{setspace}\onehalfspacing
output: 
  pdf_document: 
    extra_dependencies: ["float"]
    number_sections: true
bibliography: SYL.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, cache = F, warning = F, message = F)
library(tidyverse)
library(lme4)
library(ggplot2)
library(gridExtra)
library(kableExtra)
library(GGally)
ggplot2::theme_set(ggplot2::theme_bw())
knitr::opts_chunk$set(fig.align = 'center')
knitr::opts_chunk$set(fig.pos = "H")

load("bias_result_full.RData")
bias_result_full$confound_treatment = factor(bias_result_full$confound_treatment)
levels(bias_result_full$confound_treatment)[levels(bias_result_full$confound_treatment)=="Uniform"] <- "Very Strong"
```


\section{Introduction}

Panel data analysis is a widely used statistical tool in social sciences, econometrics and ecology to study the relationships between variables over time. However, this type of analysis is susceptible to confounding variables, which can bias the estimated coefficients and distort the interpretation of the results. 
Fixed and random effects models frequently emerge in panel data analysis to account for confounding variables that are time-invariant [@gunasekara2014fixed] or time-varying [@li2011nonpara; @ahn2013panel]. 
A common belief among econometricians is that fixed effects (FE) or random effects (RE) models can absorb unmeasured confounding variables [@angrist2009mostly], but the mechanism behind this claim is mysterious and not well-understood. 
In this research paper, we aim to explore the relationship between fixed/random effects and time-invariant unmeasured confounding in panel data analysis and provide insights into whether and in what sense these models can address this issue.

Our simulation suggests that fixed/random effects can remedy the issue of unmeasured confounding to a certain extent, but there are still systematic bias resulting from the relationship between unmeasured confounding and the treatment assignment. **[more stuff here]**




\section{Background}

In typical observational studies, failing to capture significant unmeasured confounding gives rise to biased estimates of treatment effects, which compels practitioners to develop methods of assessing and handling uncontrolled confounding [@vanderweele2011unmeasured]. 
The question of whether fixed/random effects models can account for unmeasured confounding in panel data analysis has been the subject of much debate particuarly in the econometrics literature. 
A number of studies have explored this issue from different angles and with varying degrees of empirical evidence.

One line of research has focused on theoretical arguments for why fixed/random effects models might be effective at absorbing unmeasured confounding. 
For example, @angrist2009mostly discuss the strategies that use data with a time or cohort dimension to control for unobserved-but-fixed omitted variables.
@hausman1981panel argue that fixed effects models can control for the time-invariant confounders by essentially differencing them out, while random effects models can account for time-varying confounders that are uncorrelated with the fixed effects. More recently, @wooldridge2010econometric has suggested that fixed effects models can be viewed as a form of quasi-experimental design that mimics a randomized controlled trial, and thus can address the unobserved component to the extent that such designs do.

Other scholars have openly challenged the notion that fixed/random effects models can fully absorbing unmeasured confounding. For example, @mundlak1978pooling once argued that random effects models are biased when unobserved heterogeneity is correlated with observed variables, and that fixed effects models are limited by the fact that they cannot correctly estimate time-invariant confoundings. 
@hazlett2022understanding point out that random effect estimates in multilevel models are equivalent to fixed effects estimates that have been shrunken through a regularization process. When the source of unmeasured confounding is at the group-level, the FE approach could unbiasedly estimates treatment effects, but with poor estimates of standard errors. Bias takes place in random effects models because their variables are not “allowed” to adjust for confounding as intended and thus fails to remove the unmeasured confounding.
Furthermore, @bell2015explaining note that while fixed effects models can provide reasonable estimates of treatment effects, they may still suffer from omitted variable bias if the unobserved confounding variable is correlated with the time-varying variables.

Therefore, the effectiveness of fixed/random effects models in accounting for unmeasured confounding and obtaining unbiased estimates of treatment effects in panel data analysis remains a topic of ongoing research and debate.
As such, our projects seeks to explore the trends of potential bias when applying fixed/random effects models in the events of unmeasured confounding.



\section{Method}

We explore the our research question with a simulation study.  

```{r DAG, fig.cap="\\label{fig:causal_DAG} Visualize the problem of unmeasured confoudning using a causal DAG",out.width="50%"}
knitr::include_graphics("Image/DAG.png")
```

We presume that specifying an intercept for every individual in the study (using either FE or RE model) is an appropriate method to address unmeasured confounding, $A$. 

\subsection{Continuous Case}

Our data generation process (DGP) uses the following model specifications:
<!-- E\left(\mathrm{Y}_{i t} \mid A_i, \mathrm{X}_{i t}, t, \mathrm{D}_{i t}\right)& =\alpha+\lambda_t+\rho \mathrm{D}_{i t}+ \gamma A_i+ \delta \mathrm{X}_{i t} \\ -->
$$
\begin{aligned}
Y_{it} &= \alpha+\lambda_t+ \delta \mathrm{X}_{i t}+\rho \mathrm{D}_{i t}+ \gamma A_i+\phi \mathrm{D}_{i t} A_i +\epsilon_{it} \\
\end{aligned}
$$

In our DGP of artificial panel data, there are 100 individuals and 10 time points. Covariate, $X$, for each individual is simulated from $N(0,1)$. The unmeasured counfounding, $A$, is either from $N(0,1)$ or $\text{Uniform(0,1)}$. At half time ($t=5$), treatment is given to those in the treatment group. 

We designed two ways that the unmeasured confounding, A, could affect the treatment assignment: First, as $A\sim N(0,1)$ is above or below a certain cut-off point, the probability of receiving the treatment changes to a respectively value. Second, $A\sim \text{Uniform}(0,1)$ directly serves as the probability of receiving the treatment. 

The outcome variable, $Y_it$, is continuous and generated from a linear model including: 

* The true coefficient for covariate, $\delta$, is chosen arbitrarily as 1 or 5. 

* The true treatment effect, i.e. the coefficient of treatment status, $\rho$, could vary from to [ ] to [ ].

* The true coefficient of unmeasured confounding, $\gamma$, could vary from to [ ] to [ ], with zero meaning that there is no direct effect of unmeasured confounding on the outcome. 

* The true coefficient of the interaction between the treatment and the unmeasured confounding, $\gamma$, could var from to [ ] to [ ], with zero meaning that there is no interaction effect. 

* The noise term, $\epsilon_{it}$, is set to follow $N(0,1)$. 


**Estimator**

We have several types of methods below that provide estimations of the treatment effects. 


**Difference-in-difference (DID) estimator**

The Difference-in-Differences (DID) method is a quasi-experimental approach used to estimate the causal effect of a treatment in panel data. Its formulation could be viewed using the difference between the "Before-after (BA)" estimators of treatment and of control groups, which makes it easier and faster to calculate than regression-based models. Nevertheless, adding time-varying covariates and interaction terms are easier to do in parametric models rather than DID.  

$$
\begin{aligned}
\tau^{DID} &= (\bar Y_{1, t+1} - \bar Y_{1, t}) - (\bar Y_{0, t+1} - \bar Y_{0, t}) \\
&=\hat\tau^{BA}_1-\hat\tau^{BA}_0
\end{aligned}
$$


**OLS model**

very likely to be heavily biased since it does not remedy unmeasured confounding or potential interactions. 

$$
\begin{aligned}
Y_{it} &= \alpha+\lambda_t+\rho \mathrm{D}_{i t}+ \delta \mathrm{X}_{i t}+ \epsilon_{it} 
\end{aligned}
$$


**Fixed effects model**

Probably good performance, but would be biased if there is interaction effect missing

$$
\begin{aligned}
\alpha_i &\equiv \alpha+ \gamma A_i\\
Y_{it} &= \alpha_i+\lambda_t+\rho \mathrm{D}_{i t}+ \delta \mathrm{X}_{i t}+ \epsilon_{it} 
\end{aligned}
$$


**Random effects model**

Our random effects model is essentially a random intercept (RI) model. The argument that RI could account for unmeasured confounding is theoretically problematic due to its modeling specification. 
In particular, bias emerges when the random effects are correlated with the treatment. Because the group-specific intercepts in a RI model are regularized, they do not achieve the values that would “fully absorb” group-specific confounding, leaving components unexplained that can instead be captured by FE [@hazlett2022understanding]. 

$$
\begin{aligned}
Y_{it} &= \alpha_i+\lambda_t+\rho \mathrm{D}_{i t}+ \delta \mathrm{X}_{i t}+ \epsilon_{it} \\
& \text{where } \alpha_i | D, X \overset{i.i.d}\sim N(\mu, \sigma^2)
\end{aligned}
$$

We use `lmer` from the `lme4` package to fit the random intercept model using REML. 

\subsection{Binary Case}

FE: logit(Y) = ...

RE: `glmer` from the `lme4`


\section{Result}

In Figure \ref{fig:bias_with_ols}, we show that 

```{r With OLS, fig.cap="\\label{fig:bias_with_ols} Average bias of estimated treatment effects from four types of estimation methods.",fig.height=6, fig.width=11, out.width="75%"}
gridExtra::grid.arrange(
bias_result_full %>% pivot_longer(cols = c("DID_bias","OLS_bias","FE_bias", "RE_bias"), names_to = "Bias_Type", values_to = "Bias") %>%
  filter(rho == 5) %>%
  ggplot(aes(x = gamma, y = Bias, color = Bias_Type)) + geom_point() + geom_line() + facet_wrap(~confound_treatment) + labs(x = expression(gamma))
,
bias_result_full %>% pivot_longer(cols = c("DID_bias","OLS_bias","FE_bias", "RE_bias"), names_to = "Bias_Type", values_to = "Bias") %>%
  filter(gamma == 5) %>%
  ggplot(aes(x = rho, y = Bias, color = Bias_Type)) + geom_point() + geom_line() + facet_wrap(~confound_treatment) + labs(x = expression(rho))
)
```


In Figure \ref{fig:bias_without_ols}, we show that 

```{r Without OLS, fig.cap="\\label{fig:bias_without_ols} Compareing average bias of estimated treatment effects from DID, FE, and RE models.",fig.height=6, fig.width=11, out.width="75%"}
gridExtra::grid.arrange(
bias_result_full %>% pivot_longer(cols = c("DID_bias","OLS_bias","FE_bias", "RE_bias"), names_to = "Bias_Type", values_to = "Bias") %>%
  filter(Bias_Type != "OLS_bias", rho == 5) %>% 
  ggplot(aes(x = gamma, y = Bias, color = Bias_Type)) + geom_point() + geom_line() + facet_wrap(~confound_treatment) + labs(x = expression(gamma))
,
bias_result_full %>% pivot_longer(cols = c("DID_bias","OLS_bias","FE_bias", "RE_bias"), names_to = "Bias_Type", values_to = "Bias") %>%
  filter(Bias_Type != "OLS_bias", gamma == 5) %>%
  ggplot(aes(x = rho, y = Bias, color = Bias_Type)) + geom_point() + geom_line()  + facet_wrap(~confound_treatment) + labs(x = expression(rho))
)
```








```{r n_of_time, fig.cap="\\label{fig:bias_with_t} Distribution of bias across varying total time points.", fig.width=10, fig.height=3.5}
load("result_data/result_5_3_gamma1_phi0.RData")
load("result_data/result_10_5_gamma1_phi0.RData")
load("result_data/result_30_15_gamma1_phi0.RData")
load("result_data/result_50_25_gamma1_phi0.RData")
gridExtra::grid.arrange(
  result_5_3_gamma1_phi0 %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias"))) %>% 
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>% 
  ggplot() + geom_boxplot(aes(x = Model, y = Bias)) + ylim(-1,1) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "T = 5, T-treat = 3"),
result_10_5_gamma1_phi0 %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>% 
  ggplot() + geom_boxplot(aes(x = Model, y = Bias)) + ylim(-1,1) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "T = 10, T-treat = 5"), 
result_30_15_gamma1_phi0 %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>%  
  ggplot() + geom_boxplot(aes(x = Model, y = Bias)) + ylim(-1,1) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "T = 30, T-treat = 15"), 
result_50_25_gamma1_phi0 %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>%  
  ggplot() + geom_boxplot(aes(x = Model, y = Bias)) + ylim(-1,1) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "T = 50, T-treat = 25"),nrow = 1)
```



```{r n_of_time_treat, fig.cap="\\label{fig:bias_with_t_treat} Distribution of bias across varying treatment time points.", fig.width=10, fig.height=3.5}
load("result_data/result_20_3_gamma1_phi0.RData")
load("result_data/result_20_8_gamma1_phi0.RData")
load("result_data/result_20_13_gamma1_phi0.RData")
load("result_data/result_20_18_gamma1_phi0.RData")

gridExtra::grid.arrange(
  result_20_3_gamma1_phi0 %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
    mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>%  
  ggplot() + geom_boxplot(aes(x = Model, y = Bias)) + ylim(-0.8,1) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "T = 20, T-treat = 3"),
result_20_8_gamma1_phi0 %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>% 
  ggplot() + geom_boxplot(aes(x = Model, y = Bias)) + ylim(-0.8,1) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "T = 20, T-treat = 8"), 
result_20_13_gamma1_phi0 %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>%  
  ggplot() + geom_boxplot(aes(x = Model, y = Bias)) + ylim(-0.8,1) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "T = 20, T-treat = 13"), 
result_20_18_gamma1_phi0 %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>% 
  ggplot() + geom_boxplot(aes(x = Model, y = Bias)) + ylim(-0.8,1) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "T = 20, T-treat = 18"),nrow = 1)
```



```{r bias_gamma, fig.cap="\\label{fig:bias_with_gamma} Distribution of bias across unmeasured confounding coefficients", fig.width=10, fig.height=3.5}
load("result_data/result_10_5_gamma3_phi0.RData")
load("result_data/result_10_5_gamma5_phi0.RData")
load("result_data/result_10_5_gamma10_phi0.RData")
load("result_data/result_10_5_gamma15_phi0.RData")

gridExtra::grid.arrange(
  result_10_5_gamma3_phi0 %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>% 
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>% 
  ggplot() + geom_boxplot(aes(x = Model, y = Bias)) + ylim(-0.6,4) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "gamma = 3"),
result_10_5_gamma5_phi0 %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>% 
  ggplot() + geom_boxplot(aes(x = Model, y = Bias)) + ylim(-0.6,4) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "gamma = 5"),
result_10_5_gamma10_phi0 %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>%  
  ggplot() + geom_boxplot(aes(x = Model, y = Bias)) + ylim(-0.6,4) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "gamma = 10"),
result_10_5_gamma15_phi0 %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>%  
  ggplot() + geom_boxplot(aes(x = Model, y = Bias)) + ylim(-0.6,4) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "gamma = 15"),nrow = 1)
```



```{r bias_rho, fig.cap="\\label{fig:bias_with_rho} Distribution of bias across true causal effects", fig.width=10, fig.height=3.5}
load("result_data/result_10_5_gamma1_rho1.RData")
load("result_data/result_10_5_gamma1_rho3.RData")
load("result_data/result_10_5_gamma1_rho5.RData")
load("result_data/result_10_5_gamma1_rho7.RData")

gridExtra::grid.arrange(
  result_10_5_gamma1_rho1 %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
    mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>%  
  ggplot() + geom_boxplot(aes(x = Model, y = Bias)) + ylim(-.7,1) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "rho = 1"),
result_10_5_gamma1_rho3 %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>% 
  ggplot() + geom_boxplot(aes(x = Model, y = Bias)) + ylim(-.7,1) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "rho = 3"),
result_10_5_gamma1_rho5 %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>% 
  ggplot() + geom_boxplot(aes(x = Model, y = Bias)) + ylim(-.7,1) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "rho = 5"),
result_10_5_gamma1_rho7 %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>% 
  ggplot() + geom_boxplot(aes(x = Model, y = Bias)) + ylim(-.7,1) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "rho = 7"), nrow = 1)
```

## Interactions

```{r bias_interaction, fig.cap="\\label{fig:bias_interaction} Distribution of bias across coefficients of interactions", fig.width=10, fig.height=9}
load("result_data/result_5_3_gamma3_phi0.RData")
load("result_data/result_5_3_gamma3_phi1.RData")
load("result_data/result_5_3_gamma3_phi3.RData")
load("result_data/result_5_3_gamma3_phi5.RData")

load("result_data/result_5_3_gamma3_phi0sq.RData")
load("result_data/result_5_3_gamma3_phi1sq.RData")
load("result_data/result_5_3_gamma3_phi3sq.RData")
load("result_data/result_5_3_gamma3_phi5sq.RData")

load("result_data/result_5_3_gamma3_phi0tri.RData")
load("result_data/result_5_3_gamma3_phi1tri.RData")
load("result_data/result_5_3_gamma3_phi3tri.RData")
load("result_data/result_5_3_gamma3_phi5tri.RData")

gridExtra::grid.arrange(
 result_5_3_gamma3_phi0 %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
   mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>% 
  ggplot() + geom_boxplot(aes(x = Model, y = Bias))+ ylim(-0.5,5) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "phi = 0, Interaction: A D"),
result_5_3_gamma3_phi1 %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>% 
  ggplot() + geom_boxplot(aes(x = Model, y = Bias))+ ylim(-0.5,5) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "phi = 1, Interaction: A D"),
result_5_3_gamma3_phi3 %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>% 
  ggplot() + geom_boxplot(aes(x = Model, y = Bias))+ ylim(-0.5,5) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "phi = 3, Interaction: A D"),
result_5_3_gamma3_phi5 %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>% 
  ggplot() + geom_boxplot(aes(x = Model, y = Bias))+ ylim(-0.5,5) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "phi = 5, Interaction: A D"), 

 result_5_3_gamma3_phi0sq %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>% 
  ggplot() + geom_boxplot(aes(x = Model, y = Bias))+ ylim(-0.5,5) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "phi = 0, Interaction: A^2 D"),
result_5_3_gamma3_phi1sq %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>%  
  ggplot() + geom_boxplot(aes(x = Model, y = Bias))+ ylim(-0.5,5) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "phi = 1, Interaction: A^2 D"),
result_5_3_gamma3_phi3sq %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>% 
  ggplot() + geom_boxplot(aes(x = Model, y = Bias))+ ylim(-0.5,5) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "phi = 3, Interaction: A^2 D"),
result_5_3_gamma3_phi5sq %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>% 
  ggplot() + geom_boxplot(aes(x = Model, y = Bias))+ ylim(-0.5,5) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "phi = 5, Interaction: A^2 D"),

 result_5_3_gamma3_phi0tri %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>% 
  ggplot() + geom_boxplot(aes(x = Model, y = Bias))+ ylim(-0.5,5) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "phi = 0, Interaction: A^3 D"),
result_5_3_gamma3_phi1tri %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>% 
  ggplot() + geom_boxplot(aes(x = Model, y = Bias))+ ylim(-0.5,5) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "phi = 1, Interaction: A^3 D"),
result_5_3_gamma3_phi3tri %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>%
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>% 
  ggplot() + geom_boxplot(aes(x = Model, y = Bias))+ ylim(-0.5,5) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "phi = 3, Interaction: A^3 D"),
result_5_3_gamma3_phi5tri %>% as_tibble() %>%
  pivot_longer(cols = c("OLS_bias","FE_bias", "RE_bias"), names_to = "Model", values_to = "Bias")%>% 
  mutate(Model = factor(Model))%>% 
  mutate(Model = factor(Model, levels = c("OLS_bias","FE_bias", "RE_bias")))%>% 
  mutate(Model = recode(Model, OLS_bias = 'OLS',FE_bias = 'FE',RE_bias = 'RE'))%>% 
  ggplot() + geom_boxplot(aes(x = Model, y = Bias))+ ylim(-0.5,5) + geom_hline(yintercept=0, linetype="dashed",color = "RED") + labs(title = "phi = 5, Interaction: A^3 D"), nrow = 3)
```













\section{Discussion}


Limitation and further direction: 

Time-variant confounding? 

More time points?

Estimated coefficients of latent variable?


Overall, the literature suggests that while fixed/random effects models may be useful in controlling for unmeasured confounding in panel data analysis, they are not a panacea. Other methods, such as instrumental variables or regression discontinuity designs, may be more necessary in certain cases to fully address this issue.



<!-- \newpage -->

\section{Reference}

